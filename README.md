# stacktrace\_compat

[![](https://img.shields.io/hexpm/v/stacktrace_compat.svg?style=flat)](https://hex.pm/packages/stacktrace_compat)
[![](https://travis-ci.org/g-andrade/stacktrace_compat.png?branch=master)](https://travis-ci.org/g-andrade/stacktrace_compat)

`stacktrace_compat` is a workaround for the `erlang:get_stacktrace()`
deprecation on Erlang/OTP 21.

\[WORK IN PROGRESS\]

It intends on smoothing near-future maintenence of projects that are to
support both pre- and post-deprecation code by avoiding code duplication
or ungainly macros.

It defines a parse transform (`stacktrace_transform`) which, when
applied to a module on OTP 21+, will replace `erlang:get_stacktrace()`
calls with instances of the stacktrace binding that was captured on the
closest catch pattern up the execution tree (within the same function.)

If no binding has been defined, a generated name will be used that's
likely to be conflict free.

If no catch pattern is found, no replacement is made. This makes sense
in naked calls to `erlang:get_stacktrace()` (as they're a no-no) but not
in calls from within caught exception helpers it's a limitation yet to
be worked out (if at all.)

#### Example

The following snippet:

``` erlang
foobar() ->
    try
        1 / (rand:uniform(2) - 1)
    catch
        error:badarith ->
            {error, {badarith, erlang:get_stacktrace()}}
    end.
```

...is transformed into:

``` erlang
foobar() ->
    try
        1 / (rand:uniform(2) - 1)
    catch
        error:badarith:StacktraceCompat444353487_1 ->
            {error, {badarith, StacktraceCompat444353487_1}}
    end.
```

-----

*Generated by EDoc*
